<!DOCTYPE html>

<!--
This page is shown when the extension button is clicked, because the
"browser_action" field in manifest.json contains the "default_popup" key with
value "popup.html".

It has been modified to be an AngularJS app.

JavaScript and HTML must be in separate files: see our Content Security
Policy documentation[1] for details and explanation.
 [1]: https://developer.chrome.com/extensions/contentSecurityPolicy
-->

<html ng-app=popup ng-csp style="height:400px;">
<head>

  <title>My Knowledge Network</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Stylesheets -->
  <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" media="screen">
  <link type="text/css" rel="stylesheet" href="lib/angular/angular-csp.css" media="screen"> <!-- @todo: minify -->
  <link type="text/css" rel="stylesheet" href="css/font-awesome.min.css" media="screen">
  <link type="text/css" rel="stylesheet" href="css/mykn.css" media="screen">  <!-- @todo minify -->
  <link type="text/css" rel="stylesheet" href="css/colors.css" media="screen">  <!-- @todo minify -->

  <script src="lib/d3/d3.min.js" charset="utf-8"></script>

</head>

<base target="_blank" />

<body style="min-width: 400px; min-height:100px; height: 400px;">

<div ng-controller="MainController">
  <!--<p class="tinytext-right">With love from <a href="http://www.learningthreads.co" tabindex="-1">{{companyShortName}}</a> #keeplearning </p>-->

  <!--<div class="text-center">-->
  <!--<input id="search" style="width:90%;" type="text" placeholder="Search My Knowledge Network" tabindex="1"/>-->
  <!--<i class="fa fa-search input-icon"></i>-->
  <!--</div>-->

  <!--<hr>-->

  <!-- Modal element to verify a user action @todo make this a directive -->
  <div class="modal fade" id="verifyModal" tabindex="-1" role="dialog" aria-labelledby="verifyModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Verify</h4>
        </div>
        <div class="modal-body">
          <!-- Yes and Cancel buttons @todo Need to implement the completeAction functionality -->
          <button class="btn btn-sm btn-success"
                  type="button"
                  ng-click="completeAction(fnc)"
                  data-dismiss="modal"
                  data-target="#newThreadButtonModal">Yes</button>
          <button class="btn btn-sm btn-danger"
                  data-dismiss="modal"
                  data-target="#newThreadButtonModal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal element to specify the thread title @todo make this a directive-->
  <div class="modal fade" id="newThreadButtonModal" tabindex="-1" role="dialog" aria-labelledby="newThreadButtonModelLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Start New Learning Thread</h4>
        </div>
        <div class="modal-body">
          <form name="newThread" class="validate" target="_blank" novalidate>

            <!-- A title for the new thread -->
            <label for="threadName">Name:</label>
            <input id="threadName"
                   type="text"
                   name="threadName"
                   placeholder="New Thread"
                   ng-model="newThreadTitle"><br>

            <!-- A description for the new thread -->
            <!--<label for="threadDescription">Description:</label><br>-->
            <!--<input id="threadDescription"-->
            <!--type="text"-->
            <!--name="threadDescription"-->
            <!--placeholder="Add your description here."-->
            <!--ng-model="newThreadDescription"><br>-->

            <!-- Add and Cancel buttons -->
            <button class="btn btn-sm btn-success"
                    type="button"
                    ng-click="addThread()"
                    data-dismiss="modal"
                    data-target="#newThreadButtonModal">Add</button>
            <button class="btn btn-sm btn-danger"
                    data-dismiss="modal"
                    data-target="#newThreadButtonModal">Cancel</button>

          </form>
        </div>
      </div>
    </div>

    <!-- Modal element to show help info @todo make this a directive-->
    <div class="modal fade" id="helpWindowModal" tabindex="-1" role="dialog" aria-labelledby="helpWindowModal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">My Knowledge Network User Guide</h4>
          </div>
          <div class="modal-body">

            <h4>What is a Thread?</h4>
            <p>A thread is a collection of resources.</p>

            <h4>What is a Resource?</h4>
            <p>A resource is a URL (e.g. "http://www.google.com"). A resource can be in as many threads you you'd like.</p>

            <h4>Adding a Resource to a Thread</h4>
            <p>To add the current URL to the current thread, just click the <b><i class="fa fa-star"></i> Add to Thread</b> button. If the resource is already in your knowledge network, just grab the <i class="fa fa-dot-circle-o"></i> and drag 'n' drop it onto the name of the thread that you'd like to add the resource to.</p>

            <h4>Connecting Resources</h4>
            <p>Resources can be connected together to improve the organization of your knowledge network. To connect two resources, just grab the <i class="fa fa-dot-circle-o"></i> and drag 'n' drop it onto another <i class="fa fa-dot-circle-o"></i> <em>Hint: This is where the magic starts happening</em></p>

            <h4>Importing Thread(s) from File</h4>
            <p>Congratulations, someone has given you a thread to import! Just press the <i class="fa fa-cloud-download"></i> button and select the file. <em>Hint: The file type is .json</em>.</p>

            <h4>Importing Resources from your Chrome Bookmarks</h4>
            <p>This is the <b>easiest</b> way to get started. Just press the <i class="fa fa-download"></i> button. <em>Hint: This may take up to 30 seconds if you have a lot of bookmarks.</em></p>

            <h4>Export Thread to File</h4>
            <p>Sweet, you're ready to share how you've learned something! Just press the <i class="fa fa-cloud-upload"></i> button and choose a file name to save the thread to. Then, you can send it to whomever you like!</p>

            <h4>View Thread in Graph Mode</h4>
            <p>This tool is in <em>beta</em>, but we've included it just for you. Visualize your thread by pressing the <i class="fa fa-share-alt"></i> button.</p>

            <!-- Exit Button -->
            <button class="btn btn-sm btn-success"
                    data-dismiss="modal"
                    data-target="#newThreadButtonModal">
              Ok!
            </button>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!--<hr>-->

  <!-- -------------------------------------- -->
  <!-- Container for the threads and stitches -->
  <!-- -------------------------------------- -->
  <div class="container-fluid" style="padding-bottom:20px;">

    <!-- Banner -->
    <div class="row" style="width:600px;">
      <div class="col-xs-3 thread-panel-color-bg" style="padding-left:0">
        <div class="button-banner">

          <!-- Button to add a new thread -->
          <!-- Opens a modal window for the user to name the thread -->
          <label for="newThreadButton">
            <i class="fa fa-plus-circle brand thread-panel-color-bg icon-action"
               data-toggle="tooltip"
               data-placement="bottom"
               title="Create new thread."
               style="margin-left:5px;">
            </i>
          </label>
          <button id="newThreadButton"
                  tabindex="2"
                  style="visibility:hidden;position:absolute;"
                  data-toggle="modal"
                  data-target="#newThreadButtonModal">
          </button>

          <!-- Button to import thread from file -->
          <label for="fileForImport">
            <i class="fa fa-cloud-download icon-action brand thread-panel-color-bg"
               data-toggle="tooltip"
               data-placement="bottom"
               title="Import thread(s) from file."
               style="margin-left:5px;">
            </i>
          </label>
          <input id="fileForImport" style="visibility:hidden;position:absolute;" type="file" accept=".json">

          <!-- Button to import from Chrome bookmarks -->
          <a data-toggle="tooltip"
             data-placement="bottom"
             title="Import Chrome bookmarks."
             ng-click="printBookmarks()">
            <i class="fa fa-download icon-action brand banner-stitches-color-bg"></i>
          </a>

          <!-- Button to show modal help -->
          <label for="helpWindow">
            <i class="fa fa-question-circle brand thread-panel-color-bg icon-action"
               data-toggle="tooltip"
               data-placement="bottom"
               title="View user guide."
               style="margin-left:5px;">
            </i>
          </label>
          <button id="helpWindow"
                  tabindex="5"
                  style="visibility:hidden;position:absolute"
                  data-toggle="modal"
                  data-target="#helpWindowModal">
          </button>

        </div>
        <hr>
      </div>
      <div class="col-xs-9 banner-stitches-color-bg" style="padding-left:0;">
        <div class="button-banner">

          <!-- Button to export thread to file -->
          <a data-toggle="tooltip"
             data-placement="bottom"
             title="Export thread to file."
             ng-click="exportGraph(currentThread.___id)">
            <i class="fa fa-cloud-upload icon-action brand banner-stitches-color-bg" style="margin-left:5px;"></i>
          </a>

          <span ng-show="visualViewFlag">
            <!-- Button to switch the view to a list -->
            <a data-toggle="tooltip"
               data-placement="bottom"
               title="Switch to list view."
               ng-click="viewList(currentThread.___id)">
              <i class="fa fa-list icon-action brand banner-stitches-color-bg" style="margin-left:5px;"></i>
            </a>
          </span>

          <span ng-show="!visualViewFlag">
            <!-- Button to switch the view to a graph -->
            <a data-toggle="tooltip"
               data-placement="bottom"
               title="Switch to graph view."
               ng-click="viewGraph(currentThread.___id)" id="visualViewButton">
              <i class="fa fa-share-alt icon-action brand banner-stitches-color-bg" style="margin-left:5px;"></i>
            </a>
          </span>

          <span ng-show="currentThread.title!==getMasterThreadTitle()">
            <!-- Button to remove thread -->
            <a data-toggle="tooltip"
               data-placement="bottom"
               title="Delete thread."
               ng-click="removeThread(currentThread.___id)">
              <i class="fa fa-trash-o icon-action brand banner-stitches-color-bg" style="padding-left:5px;"></i>
            </a>
          </span>

          <span class="spacer-right-70"></span>

          <!-- button to add stitch to thread -->
          <button class="btn btn-primary btn-xs rightify bg-brand"
                  tabindex="1"
                  ng-click="addStitch(currentThread.___id)">
            <i class="fa fa-star"></i> Add to Thread
          </button>
        </div>
        <hr>
      </div>

    </div>

    <div class="row" style="width:600px;">

      <!-- Threads -->
      <div class="col-xs-3 row-panel thread-panel thread-panel-color-bg">
        <div id="threadList">
          <div class=""
               ng-repeat="thread in getThreads() track by $index"
               ng-class="'current-thread-' + isCurrentThread(thread.title)">
            <a class="a-thread droptarget isthread thread-row"
               ng-click="selectThread(thread)"
               id="thread-{{thread.___id}}"
               drag-effects="">{{thread.title}}</a>
          </div>
        </div>
      </div>

      <!-- Stitches -->
      <div class="col-xs-9 row-panel" style="padding-left:0;">

        <!-- List View -->
        <div ng-if="!visualViewFlag" id="stitches">
          <div ng-if="stitchesExist">
            <div class="label stitch-row"
                 style="background-image: url({{stitch.favIconUrl}}); background-size: 16px;"
                 ng-class="'stitch-' + stitch.___id"
                 ng-repeat="stitch in currentStitches track by $index">
              <i class="fa fa-dot-circle-o icon-node droptarget"
                 id="stitch-{{stitch.___id}}"
                 draggable="true"
                 drag-effects>
              </i>
              <a class="a-stitch" ng-click="loadTab(stitch.url)">
                <span class="stitch-title">{{stitch.title}}</span>
              </a>
              <a ng-if="currentThread.title!==getMasterThreadTitle()"
                 ng-click="removeStitch(currentThread.___id, stitch.___id)">
                <i class="fa fa-trash-o icon-action rightify" style="background-color:white;padding-left:0;"></i>
              </a>
            </div>
          </div>
        </div>

        <!-- Visual View -->
        <div ng-if="visualViewFlag">
          <div id="visualView"></div>
        </div>

      </div>

    </div>
  </div>

  <!--<hr>-->

  <label id="emailFeedback">
    <a ng-click="sendEmailFeedback()">Email us</a> with your feedback!
    <a ng-click="sendEmailFeedback()" style="color:darkred">Report a bug.</a>
  </label>


  <label class="permissionCheck">
    Send anonymous tracking data. <a href="http://www.learningthreads.co/?page_id=1678">Learn why this is important. </a> <input type="checkbox" id="analyticsPermission" />
  </label>

</div>

<!-- Scripts: placed at end for load optimization-->
<script src="lib/jquery/jquery-1.10.2.min.js"></script>
<script src="lib/d3/d3.min.js" charset="utf-8"></script>
<script src="lib/bootstrap/bootstrap.min.js"></script>
<script src="lib/angular/angular.min.js"></script>
<script src="lib/taffy/taffy.js"></script> <!-- the "database" --> <!-- @todo minify -->
<script src="lib/google-analytics/google-analytics-bundle.js"></script>
<script src="js/popup.js"></script>

<!-- Learning Threads JS library -->
<script src="js/learning_threads.js"></script>

<!-- Library to help import and organize bookmarks -->
<script src="js/bookmark_lib.js"></script>

<!-- The front-end angular application -->
<script src="app/app.js"></script>
<script src="app/services/storage.js"></script>
<!--<script src="app/services/graphLayouts.js"></script>-->
<script src="app/controllers/controllers.js"></script>
<script src="app/directives/dragEffects.js"></script>

<script src="js/forcelayouttest.js"></script>

</body>

</html>